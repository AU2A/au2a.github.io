<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ã€Temperature 1.5 çš„æ—¥å¸¸ã€‘EP10: æ‹’çµ•é‡‘é­šè…¦ - æ·±å…¥è§£æ LangChain çš„ Short-term Memory èˆ‡ç‹€æ…‹ç®¡ç† | Aura's Space</title><meta name=keywords content="LangChain,Python,LangGraph"><meta name=description content="

æœ¬æ–‡ç‚ºå€‹äººå­¸ç¿’ç­†è¨˜ï¼Œè¨˜éŒ„äº†å­¸ç¿’éç¨‹ä¸­çš„ä¸€äº›çŸ¥è­˜ï¼Œå¯åƒè€ƒï¼Œä½†ä¸å¯èªçœŸï¼Œå­¸ç¿’çš„éç¨‹å¯èƒ½æœ‰ç†è§£éŒ¯èª¤ï¼Œè³‡è¨Šä¸ä¸€å®šæ­£ç¢ºï¼Œç•¢ç«Ÿ Temperature éƒ½ 1.5 äº†ã€‚


é›¶ã€ å‰è¨€
æ¥çºŒä¸Šæ¬¡æˆ‘å€‘èŠåˆ°çš„ MCP (Model Context Protocol)ï¼Œæˆ‘å€‘è®“ Agent èƒ½å¤ é€éé€šç”¨æ¨™æº–é€£æ¥å„å¼å„æ¨£çš„å·¥å…·èˆ‡è³‡æºã€‚ä½†å¦‚æœä½ çš„ Agent é€£æ¥äº†å…¨ä¸–ç•Œï¼Œå»è½‰é ­å°±å¿˜è¨˜ä½ æ˜¯èª°ï¼Œé‚£ä¹Ÿæ˜¯ç™½æ­ã€‚
åœ¨è¤‡é›œçš„å°è©±ä»»å‹™ä¸­ï¼Œè¨˜æ†¶ (Memory) æ˜¯æ ¸å¿ƒã€‚ä»Šå¤©æˆ‘å€‘è¦ä¾†æ¢è¨ LangChain æ–‡ä»¶ä¸­é—œæ–¼ Short-term memory (çŸ­æœŸè¨˜æ†¶) çš„å¯¦ä½œæ©Ÿåˆ¶ã€‚å¦‚ä½•åœ¨æœ‰é™çš„ Context Window å…§ï¼Œè®“ Agent æ—¢èƒ½è¨˜å¾—ä¹‹å‰çš„äº’å‹•ï¼Œåˆä¸æœƒå› ç‚ºè³‡è¨Šéè¼‰è€Œã€Œåˆ†å¿ƒã€æˆ–è®Šæ…¢ï¼Ÿè®“æˆ‘å€‘çœ‹ä¸‹å»ã€‚

ä¸€ã€ ä»€éº¼æ˜¯çŸ­æœŸè¨˜æ†¶èˆ‡ Threadï¼Ÿ
åœ¨ LangChain çš„å®šç¾©è£¡ï¼ŒçŸ­æœŸè¨˜æ†¶ä¸»è¦æŒ‡çš„æ˜¯ Thread-level persistenceã€‚
é€™æ¦‚å¿µå¾ˆåƒ Email çš„ç¾¤çµ„ä¿¡ä»¶æˆ–æ˜¯ Slack çš„è¨è«–ä¸²ã€‚ä¸€å€‹ Thread çµ„ç¹”äº†å–®ä¸€æœƒè©±ä¸­çš„æ‰€æœ‰äº’å‹•ã€‚é€™å°æ–¼ Agent è‡³é—œé‡è¦ï¼Œå› ç‚ºå®ƒéœ€è¦ï¼š

è¨˜ä½ä¹‹å‰çš„äº’å‹•ï¼ˆContextï¼‰ã€‚
å¾å›é¥‹ä¸­å­¸ç¿’ã€‚
é©æ‡‰ä½¿ç”¨è€…çš„åå¥½ã€‚

ç„¶è€Œï¼ŒæŒ‘æˆ°åœ¨æ–¼ LLM çš„ Context Window (ä¸Šä¸‹æ–‡è¦–çª—) æ˜¯æœ‰é™çš„ã€‚å³ä¾¿æ¨¡å‹æ”¯æ´è¶…é•·æ–‡æœ¬ï¼Œå¡å…¥éå¤šèˆŠè³‡è¨Šæœƒå°è‡´æ¨¡å‹ã€Œåˆ†å¿ƒ (distracted)ã€ï¼Œåæ‡‰è®Šæ…¢ä¸”æˆæœ¬è®Šé«˜ã€‚å› æ­¤ï¼Œæˆ‘å€‘éœ€è¦ä¸€å¥—æ©Ÿåˆ¶ä¾†ç®¡ç†é€™äº›è¨Šæ¯æµã€‚

äºŒã€ å•Ÿç”¨è¨˜æ†¶ï¼šCheckpointer æ˜¯é—œéµ
è¦è®“ Agent æ“æœ‰è¨˜æ†¶ï¼Œä½ ä¸èƒ½åªæ˜¯æŠŠå®ƒè·‘èµ·ä¾†ï¼Œä½ éœ€è¦åœ¨å»ºç«‹ Agent æ™‚æŒ‡å®šä¸€å€‹ checkpointerã€‚
LangChain çš„ Agent å°‡è¨˜æ†¶è¦–ç‚º State (ç‹€æ…‹) çš„ä¸€éƒ¨åˆ†ã€‚"><meta name=author content="Aura"><link rel=canonical href=https://aura.codex.tw/posts/temp1.5/ep10/><link crossorigin=anonymous href=/assets/css/stylesheet.0a190288459736d4d10e13cb6ee8068b9aa282b3f8938264b3b2d6a98bf701b7.css integrity="sha256-ChkCiEWXNtTRDhPLbugGi5qigrP4k4Jks7LWqYv3Abc=" rel="preload stylesheet" as=style><link rel=icon href=https://aura.codex.tw/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://aura.codex.tw/images/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://aura.codex.tw/images/favicon.ico><link rel=apple-touch-icon href=https://aura.codex.tw/images/favicon.ico><link rel=mask-icon href=https://aura.codex.tw/images/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://aura.codex.tw/posts/temp1.5/ep10/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://aura.codex.tw/posts/temp1.5/ep10/"><meta property="og:site_name" content="Aura's Space"><meta property="og:title" content="ã€Temperature 1.5 çš„æ—¥å¸¸ã€‘EP10: æ‹’çµ•é‡‘é­šè…¦ - æ·±å…¥è§£æ LangChain çš„ Short-term Memory èˆ‡ç‹€æ…‹ç®¡ç†"><meta property="og:description" content=" æœ¬æ–‡ç‚ºå€‹äººå­¸ç¿’ç­†è¨˜ï¼Œè¨˜éŒ„äº†å­¸ç¿’éç¨‹ä¸­çš„ä¸€äº›çŸ¥è­˜ï¼Œå¯åƒè€ƒï¼Œä½†ä¸å¯èªçœŸï¼Œå­¸ç¿’çš„éç¨‹å¯èƒ½æœ‰ç†è§£éŒ¯èª¤ï¼Œè³‡è¨Šä¸ä¸€å®šæ­£ç¢ºï¼Œç•¢ç«Ÿ Temperature éƒ½ 1.5 äº†ã€‚
é›¶ã€ å‰è¨€ æ¥çºŒä¸Šæ¬¡æˆ‘å€‘èŠåˆ°çš„ MCP (Model Context Protocol)ï¼Œæˆ‘å€‘è®“ Agent èƒ½å¤ é€éé€šç”¨æ¨™æº–é€£æ¥å„å¼å„æ¨£çš„å·¥å…·èˆ‡è³‡æºã€‚ä½†å¦‚æœä½ çš„ Agent é€£æ¥äº†å…¨ä¸–ç•Œï¼Œå»è½‰é ­å°±å¿˜è¨˜ä½ æ˜¯èª°ï¼Œé‚£ä¹Ÿæ˜¯ç™½æ­ã€‚
åœ¨è¤‡é›œçš„å°è©±ä»»å‹™ä¸­ï¼Œè¨˜æ†¶ (Memory) æ˜¯æ ¸å¿ƒã€‚ä»Šå¤©æˆ‘å€‘è¦ä¾†æ¢è¨ LangChain æ–‡ä»¶ä¸­é—œæ–¼ Short-term memory (çŸ­æœŸè¨˜æ†¶) çš„å¯¦ä½œæ©Ÿåˆ¶ã€‚å¦‚ä½•åœ¨æœ‰é™çš„ Context Window å…§ï¼Œè®“ Agent æ—¢èƒ½è¨˜å¾—ä¹‹å‰çš„äº’å‹•ï¼Œåˆä¸æœƒå› ç‚ºè³‡è¨Šéè¼‰è€Œã€Œåˆ†å¿ƒã€æˆ–è®Šæ…¢ï¼Ÿè®“æˆ‘å€‘çœ‹ä¸‹å»ã€‚
ä¸€ã€ ä»€éº¼æ˜¯çŸ­æœŸè¨˜æ†¶èˆ‡ Threadï¼Ÿ åœ¨ LangChain çš„å®šç¾©è£¡ï¼ŒçŸ­æœŸè¨˜æ†¶ä¸»è¦æŒ‡çš„æ˜¯ Thread-level persistenceã€‚
é€™æ¦‚å¿µå¾ˆåƒ Email çš„ç¾¤çµ„ä¿¡ä»¶æˆ–æ˜¯ Slack çš„è¨è«–ä¸²ã€‚ä¸€å€‹ Thread çµ„ç¹”äº†å–®ä¸€æœƒè©±ä¸­çš„æ‰€æœ‰äº’å‹•ã€‚é€™å°æ–¼ Agent è‡³é—œé‡è¦ï¼Œå› ç‚ºå®ƒéœ€è¦ï¼š
è¨˜ä½ä¹‹å‰çš„äº’å‹•ï¼ˆContextï¼‰ã€‚ å¾å›é¥‹ä¸­å­¸ç¿’ã€‚ é©æ‡‰ä½¿ç”¨è€…çš„åå¥½ã€‚ ç„¶è€Œï¼ŒæŒ‘æˆ°åœ¨æ–¼ LLM çš„ Context Window (ä¸Šä¸‹æ–‡è¦–çª—) æ˜¯æœ‰é™çš„ã€‚å³ä¾¿æ¨¡å‹æ”¯æ´è¶…é•·æ–‡æœ¬ï¼Œå¡å…¥éå¤šèˆŠè³‡è¨Šæœƒå°è‡´æ¨¡å‹ã€Œåˆ†å¿ƒ (distracted)ã€ï¼Œåæ‡‰è®Šæ…¢ä¸”æˆæœ¬è®Šé«˜ã€‚å› æ­¤ï¼Œæˆ‘å€‘éœ€è¦ä¸€å¥—æ©Ÿåˆ¶ä¾†ç®¡ç†é€™äº›è¨Šæ¯æµã€‚
äºŒã€ å•Ÿç”¨è¨˜æ†¶ï¼šCheckpointer æ˜¯é—œéµ è¦è®“ Agent æ“æœ‰è¨˜æ†¶ï¼Œä½ ä¸èƒ½åªæ˜¯æŠŠå®ƒè·‘èµ·ä¾†ï¼Œä½ éœ€è¦åœ¨å»ºç«‹ Agent æ™‚æŒ‡å®šä¸€å€‹ checkpointerã€‚
LangChain çš„ Agent å°‡è¨˜æ†¶è¦–ç‚º State (ç‹€æ…‹) çš„ä¸€éƒ¨åˆ†ã€‚"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-11-07T00:00:00+00:00"><meta property="article:modified_time" content="2025-11-07T00:00:00+00:00"><meta property="article:tag" content="LangChain"><meta property="article:tag" content="Python"><meta property="article:tag" content="LangGraph"><meta name=twitter:card content="summary"><meta name=twitter:title content="ã€Temperature 1.5 çš„æ—¥å¸¸ã€‘EP10: æ‹’çµ•é‡‘é­šè…¦ - æ·±å…¥è§£æ LangChain çš„ Short-term Memory èˆ‡ç‹€æ…‹ç®¡ç†"><meta name=twitter:description content="

æœ¬æ–‡ç‚ºå€‹äººå­¸ç¿’ç­†è¨˜ï¼Œè¨˜éŒ„äº†å­¸ç¿’éç¨‹ä¸­çš„ä¸€äº›çŸ¥è­˜ï¼Œå¯åƒè€ƒï¼Œä½†ä¸å¯èªçœŸï¼Œå­¸ç¿’çš„éç¨‹å¯èƒ½æœ‰ç†è§£éŒ¯èª¤ï¼Œè³‡è¨Šä¸ä¸€å®šæ­£ç¢ºï¼Œç•¢ç«Ÿ Temperature éƒ½ 1.5 äº†ã€‚


é›¶ã€ å‰è¨€
æ¥çºŒä¸Šæ¬¡æˆ‘å€‘èŠåˆ°çš„ MCP (Model Context Protocol)ï¼Œæˆ‘å€‘è®“ Agent èƒ½å¤ é€éé€šç”¨æ¨™æº–é€£æ¥å„å¼å„æ¨£çš„å·¥å…·èˆ‡è³‡æºã€‚ä½†å¦‚æœä½ çš„ Agent é€£æ¥äº†å…¨ä¸–ç•Œï¼Œå»è½‰é ­å°±å¿˜è¨˜ä½ æ˜¯èª°ï¼Œé‚£ä¹Ÿæ˜¯ç™½æ­ã€‚
åœ¨è¤‡é›œçš„å°è©±ä»»å‹™ä¸­ï¼Œè¨˜æ†¶ (Memory) æ˜¯æ ¸å¿ƒã€‚ä»Šå¤©æˆ‘å€‘è¦ä¾†æ¢è¨ LangChain æ–‡ä»¶ä¸­é—œæ–¼ Short-term memory (çŸ­æœŸè¨˜æ†¶) çš„å¯¦ä½œæ©Ÿåˆ¶ã€‚å¦‚ä½•åœ¨æœ‰é™çš„ Context Window å…§ï¼Œè®“ Agent æ—¢èƒ½è¨˜å¾—ä¹‹å‰çš„äº’å‹•ï¼Œåˆä¸æœƒå› ç‚ºè³‡è¨Šéè¼‰è€Œã€Œåˆ†å¿ƒã€æˆ–è®Šæ…¢ï¼Ÿè®“æˆ‘å€‘çœ‹ä¸‹å»ã€‚

ä¸€ã€ ä»€éº¼æ˜¯çŸ­æœŸè¨˜æ†¶èˆ‡ Threadï¼Ÿ
åœ¨ LangChain çš„å®šç¾©è£¡ï¼ŒçŸ­æœŸè¨˜æ†¶ä¸»è¦æŒ‡çš„æ˜¯ Thread-level persistenceã€‚
é€™æ¦‚å¿µå¾ˆåƒ Email çš„ç¾¤çµ„ä¿¡ä»¶æˆ–æ˜¯ Slack çš„è¨è«–ä¸²ã€‚ä¸€å€‹ Thread çµ„ç¹”äº†å–®ä¸€æœƒè©±ä¸­çš„æ‰€æœ‰äº’å‹•ã€‚é€™å°æ–¼ Agent è‡³é—œé‡è¦ï¼Œå› ç‚ºå®ƒéœ€è¦ï¼š

è¨˜ä½ä¹‹å‰çš„äº’å‹•ï¼ˆContextï¼‰ã€‚
å¾å›é¥‹ä¸­å­¸ç¿’ã€‚
é©æ‡‰ä½¿ç”¨è€…çš„åå¥½ã€‚

ç„¶è€Œï¼ŒæŒ‘æˆ°åœ¨æ–¼ LLM çš„ Context Window (ä¸Šä¸‹æ–‡è¦–çª—) æ˜¯æœ‰é™çš„ã€‚å³ä¾¿æ¨¡å‹æ”¯æ´è¶…é•·æ–‡æœ¬ï¼Œå¡å…¥éå¤šèˆŠè³‡è¨Šæœƒå°è‡´æ¨¡å‹ã€Œåˆ†å¿ƒ (distracted)ã€ï¼Œåæ‡‰è®Šæ…¢ä¸”æˆæœ¬è®Šé«˜ã€‚å› æ­¤ï¼Œæˆ‘å€‘éœ€è¦ä¸€å¥—æ©Ÿåˆ¶ä¾†ç®¡ç†é€™äº›è¨Šæ¯æµã€‚

äºŒã€ å•Ÿç”¨è¨˜æ†¶ï¼šCheckpointer æ˜¯é—œéµ
è¦è®“ Agent æ“æœ‰è¨˜æ†¶ï¼Œä½ ä¸èƒ½åªæ˜¯æŠŠå®ƒè·‘èµ·ä¾†ï¼Œä½ éœ€è¦åœ¨å»ºç«‹ Agent æ™‚æŒ‡å®šä¸€å€‹ checkpointerã€‚
LangChain çš„ Agent å°‡è¨˜æ†¶è¦–ç‚º State (ç‹€æ…‹) çš„ä¸€éƒ¨åˆ†ã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://aura.codex.tw/posts/"},{"@type":"ListItem","position":2,"name":"ã€Temperature 1.5 çš„æ—¥å¸¸ã€‘EP10: æ‹’çµ•é‡‘é­šè…¦ - æ·±å…¥è§£æ LangChain çš„ Short-term Memory èˆ‡ç‹€æ…‹ç®¡ç†","item":"https://aura.codex.tw/posts/temp1.5/ep10/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ã€Temperature 1.5 çš„æ—¥å¸¸ã€‘EP10: æ‹’çµ•é‡‘é­šè…¦ - æ·±å…¥è§£æ LangChain çš„ Short-term Memory èˆ‡ç‹€æ…‹ç®¡ç†","name":"ã€Temperature 1.5 çš„æ—¥å¸¸ã€‘EP10: æ‹’çµ•é‡‘é­šè…¦ - æ·±å…¥è§£æ LangChain çš„ Short-term Memory èˆ‡ç‹€æ…‹ç®¡ç†","description":" æœ¬æ–‡ç‚ºå€‹äººå­¸ç¿’ç­†è¨˜ï¼Œè¨˜éŒ„äº†å­¸ç¿’éç¨‹ä¸­çš„ä¸€äº›çŸ¥è­˜ï¼Œå¯åƒè€ƒï¼Œä½†ä¸å¯èªçœŸï¼Œå­¸ç¿’çš„éç¨‹å¯èƒ½æœ‰ç†è§£éŒ¯èª¤ï¼Œè³‡è¨Šä¸ä¸€å®šæ­£ç¢ºï¼Œç•¢ç«Ÿ Temperature éƒ½ 1.5 äº†ã€‚\né›¶ã€ å‰è¨€ æ¥çºŒä¸Šæ¬¡æˆ‘å€‘èŠåˆ°çš„ MCP (Model Context Protocol)ï¼Œæˆ‘å€‘è®“ Agent èƒ½å¤ é€éé€šç”¨æ¨™æº–é€£æ¥å„å¼å„æ¨£çš„å·¥å…·èˆ‡è³‡æºã€‚ä½†å¦‚æœä½ çš„ Agent é€£æ¥äº†å…¨ä¸–ç•Œï¼Œå»è½‰é ­å°±å¿˜è¨˜ä½ æ˜¯èª°ï¼Œé‚£ä¹Ÿæ˜¯ç™½æ­ã€‚\nåœ¨è¤‡é›œçš„å°è©±ä»»å‹™ä¸­ï¼Œè¨˜æ†¶ (Memory) æ˜¯æ ¸å¿ƒã€‚ä»Šå¤©æˆ‘å€‘è¦ä¾†æ¢è¨ LangChain æ–‡ä»¶ä¸­é—œæ–¼ Short-term memory (çŸ­æœŸè¨˜æ†¶) çš„å¯¦ä½œæ©Ÿåˆ¶ã€‚å¦‚ä½•åœ¨æœ‰é™çš„ Context Window å…§ï¼Œè®“ Agent æ—¢èƒ½è¨˜å¾—ä¹‹å‰çš„äº’å‹•ï¼Œåˆä¸æœƒå› ç‚ºè³‡è¨Šéè¼‰è€Œã€Œåˆ†å¿ƒã€æˆ–è®Šæ…¢ï¼Ÿè®“æˆ‘å€‘çœ‹ä¸‹å»ã€‚\nä¸€ã€ ä»€éº¼æ˜¯çŸ­æœŸè¨˜æ†¶èˆ‡ Threadï¼Ÿ åœ¨ LangChain çš„å®šç¾©è£¡ï¼ŒçŸ­æœŸè¨˜æ†¶ä¸»è¦æŒ‡çš„æ˜¯ Thread-level persistenceã€‚\né€™æ¦‚å¿µå¾ˆåƒ Email çš„ç¾¤çµ„ä¿¡ä»¶æˆ–æ˜¯ Slack çš„è¨è«–ä¸²ã€‚ä¸€å€‹ Thread çµ„ç¹”äº†å–®ä¸€æœƒè©±ä¸­çš„æ‰€æœ‰äº’å‹•ã€‚é€™å°æ–¼ Agent è‡³é—œé‡è¦ï¼Œå› ç‚ºå®ƒéœ€è¦ï¼š\nè¨˜ä½ä¹‹å‰çš„äº’å‹•ï¼ˆContextï¼‰ã€‚ å¾å›é¥‹ä¸­å­¸ç¿’ã€‚ é©æ‡‰ä½¿ç”¨è€…çš„åå¥½ã€‚ ç„¶è€Œï¼ŒæŒ‘æˆ°åœ¨æ–¼ LLM çš„ Context Window (ä¸Šä¸‹æ–‡è¦–çª—) æ˜¯æœ‰é™çš„ã€‚å³ä¾¿æ¨¡å‹æ”¯æ´è¶…é•·æ–‡æœ¬ï¼Œå¡å…¥éå¤šèˆŠè³‡è¨Šæœƒå°è‡´æ¨¡å‹ã€Œåˆ†å¿ƒ (distracted)ã€ï¼Œåæ‡‰è®Šæ…¢ä¸”æˆæœ¬è®Šé«˜ã€‚å› æ­¤ï¼Œæˆ‘å€‘éœ€è¦ä¸€å¥—æ©Ÿåˆ¶ä¾†ç®¡ç†é€™äº›è¨Šæ¯æµã€‚\näºŒã€ å•Ÿç”¨è¨˜æ†¶ï¼šCheckpointer æ˜¯é—œéµ è¦è®“ Agent æ“æœ‰è¨˜æ†¶ï¼Œä½ ä¸èƒ½åªæ˜¯æŠŠå®ƒè·‘èµ·ä¾†ï¼Œä½ éœ€è¦åœ¨å»ºç«‹ Agent æ™‚æŒ‡å®šä¸€å€‹ checkpointerã€‚\nLangChain çš„ Agent å°‡è¨˜æ†¶è¦–ç‚º State (ç‹€æ…‹) çš„ä¸€éƒ¨åˆ†ã€‚\n","keywords":["LangChain","Python","LangGraph"],"articleBody":" æœ¬æ–‡ç‚ºå€‹äººå­¸ç¿’ç­†è¨˜ï¼Œè¨˜éŒ„äº†å­¸ç¿’éç¨‹ä¸­çš„ä¸€äº›çŸ¥è­˜ï¼Œå¯åƒè€ƒï¼Œä½†ä¸å¯èªçœŸï¼Œå­¸ç¿’çš„éç¨‹å¯èƒ½æœ‰ç†è§£éŒ¯èª¤ï¼Œè³‡è¨Šä¸ä¸€å®šæ­£ç¢ºï¼Œç•¢ç«Ÿ Temperature éƒ½ 1.5 äº†ã€‚\né›¶ã€ å‰è¨€ æ¥çºŒä¸Šæ¬¡æˆ‘å€‘èŠåˆ°çš„ MCP (Model Context Protocol)ï¼Œæˆ‘å€‘è®“ Agent èƒ½å¤ é€éé€šç”¨æ¨™æº–é€£æ¥å„å¼å„æ¨£çš„å·¥å…·èˆ‡è³‡æºã€‚ä½†å¦‚æœä½ çš„ Agent é€£æ¥äº†å…¨ä¸–ç•Œï¼Œå»è½‰é ­å°±å¿˜è¨˜ä½ æ˜¯èª°ï¼Œé‚£ä¹Ÿæ˜¯ç™½æ­ã€‚\nåœ¨è¤‡é›œçš„å°è©±ä»»å‹™ä¸­ï¼Œè¨˜æ†¶ (Memory) æ˜¯æ ¸å¿ƒã€‚ä»Šå¤©æˆ‘å€‘è¦ä¾†æ¢è¨ LangChain æ–‡ä»¶ä¸­é—œæ–¼ Short-term memory (çŸ­æœŸè¨˜æ†¶) çš„å¯¦ä½œæ©Ÿåˆ¶ã€‚å¦‚ä½•åœ¨æœ‰é™çš„ Context Window å…§ï¼Œè®“ Agent æ—¢èƒ½è¨˜å¾—ä¹‹å‰çš„äº’å‹•ï¼Œåˆä¸æœƒå› ç‚ºè³‡è¨Šéè¼‰è€Œã€Œåˆ†å¿ƒã€æˆ–è®Šæ…¢ï¼Ÿè®“æˆ‘å€‘çœ‹ä¸‹å»ã€‚\nä¸€ã€ ä»€éº¼æ˜¯çŸ­æœŸè¨˜æ†¶èˆ‡ Threadï¼Ÿ åœ¨ LangChain çš„å®šç¾©è£¡ï¼ŒçŸ­æœŸè¨˜æ†¶ä¸»è¦æŒ‡çš„æ˜¯ Thread-level persistenceã€‚\né€™æ¦‚å¿µå¾ˆåƒ Email çš„ç¾¤çµ„ä¿¡ä»¶æˆ–æ˜¯ Slack çš„è¨è«–ä¸²ã€‚ä¸€å€‹ Thread çµ„ç¹”äº†å–®ä¸€æœƒè©±ä¸­çš„æ‰€æœ‰äº’å‹•ã€‚é€™å°æ–¼ Agent è‡³é—œé‡è¦ï¼Œå› ç‚ºå®ƒéœ€è¦ï¼š\nè¨˜ä½ä¹‹å‰çš„äº’å‹•ï¼ˆContextï¼‰ã€‚ å¾å›é¥‹ä¸­å­¸ç¿’ã€‚ é©æ‡‰ä½¿ç”¨è€…çš„åå¥½ã€‚ ç„¶è€Œï¼ŒæŒ‘æˆ°åœ¨æ–¼ LLM çš„ Context Window (ä¸Šä¸‹æ–‡è¦–çª—) æ˜¯æœ‰é™çš„ã€‚å³ä¾¿æ¨¡å‹æ”¯æ´è¶…é•·æ–‡æœ¬ï¼Œå¡å…¥éå¤šèˆŠè³‡è¨Šæœƒå°è‡´æ¨¡å‹ã€Œåˆ†å¿ƒ (distracted)ã€ï¼Œåæ‡‰è®Šæ…¢ä¸”æˆæœ¬è®Šé«˜ã€‚å› æ­¤ï¼Œæˆ‘å€‘éœ€è¦ä¸€å¥—æ©Ÿåˆ¶ä¾†ç®¡ç†é€™äº›è¨Šæ¯æµã€‚\näºŒã€ å•Ÿç”¨è¨˜æ†¶ï¼šCheckpointer æ˜¯é—œéµ è¦è®“ Agent æ“æœ‰è¨˜æ†¶ï¼Œä½ ä¸èƒ½åªæ˜¯æŠŠå®ƒè·‘èµ·ä¾†ï¼Œä½ éœ€è¦åœ¨å»ºç«‹ Agent æ™‚æŒ‡å®šä¸€å€‹ checkpointerã€‚\nLangChain çš„ Agent å°‡è¨˜æ†¶è¦–ç‚º State (ç‹€æ…‹) çš„ä¸€éƒ¨åˆ†ã€‚\nStateï¼šå„²å­˜å°è©±æ­·å²èˆ‡è®Šæ•¸ã€‚ Checkpointerï¼šè² è²¬å°‡ State æŒä¹…åŒ–åˆ°è³‡æ–™åº«æˆ–è¨˜æ†¶é«”ä¸­ã€‚ 1. é–‹ç™¼éšæ®µ (In Memory) åœ¨æ¸¬è©¦æ™‚ï¼Œæˆ‘å€‘é€šå¸¸ä½¿ç”¨ InMemorySaverï¼Œå®ƒåªæœƒæ´»åœ¨ç•¶ä¸‹çš„åŸ·è¡Œç’°å¢ƒä¸­ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 from langgraph.checkpoint.memory import InMemorySaver from langchain.agents import create_agent agent = create_agent( \"gpt-5\", tools=[get_user_info], # åŠ ä¸Šé€™è¡Œï¼ŒAgent å°±æœ‰è…¦å­äº† checkpointer=InMemorySaver(), ) # è¨˜å¾—å¸¶ä¸Š thread_idï¼Œé€™æ˜¯è¨˜æ†¶çš„é‘°åŒ™ agent.invoke( {\"messages\": [{\"role\": \"user\", \"content\": \"Hi! My name is Bob.\"}]}, {\"configurable\": {\"thread_id\": \"1\"}}, ) #### 2. ç”Ÿç”¢ç’°å¢ƒ (Database)\rä¸Šç·šå¾Œï¼Œä½ éœ€è¦å°‡ç‹€æ…‹å­˜é€²è³‡æ–™åº«ã€‚LangChain æä¾›äº† `langgraph-checkpoint-postgres` ç­‰å¥—ä»¶ã€‚\r```python\rfrom langgraph.checkpoint.postgres import PostgresSaver\r# é€é Connection String é€£æ¥ Postgres\rwith PostgresSaver.from_conn_string(DB_URI) as checkpointer:\rcheckpointer.setup() # è‡ªå‹•å»ºç«‹è³‡æ–™è¡¨\ragent = create_agent(..., checkpointer=checkpointer)\r```\r---\r### ä¸‰ã€ å®šè£½ä½ çš„å¤§è…¦ï¼šCustomizing Agent State\ré è¨­æƒ…æ³ä¸‹ï¼ŒAgent ä½¿ç”¨ `AgentState` ä¾†ç®¡ç†è¨˜æ†¶ï¼Œè£¡é¢ä¸»è¦å°±æ˜¯ `messages`ã€‚ä½†ç¾å¯¦ä¸–ç•Œä¸­ï¼Œæˆ‘å€‘å¾€å¾€éœ€è¦å­˜æ›´å¤šæ±è¥¿ï¼Œæ¯”å¦‚ä½¿ç”¨è€… ID æˆ–åå¥½è¨­å®šã€‚\ræˆ‘å€‘å¯ä»¥ç¹¼æ‰¿ `AgentState` ä¾†æ“´å…… schemaï¼š\r```python\rclass CustomAgentState(AgentState):\ruser_id: str # æ–°å¢æ¬„ä½\rpreferences: dict # æ–°å¢æ¬„ä½\ragent = create_agent(\r\"gpt-5\",\rtools=[...],\rstate_schema=CustomAgentState, # å‘Šè¨´ Agent æ–°çš„è…¦å®¹é‡çµæ§‹\rcheckpointer=InMemorySaver(),\r)\r```\ré€™æ¨£æˆ‘å€‘å°±èƒ½åœ¨ `invoke` æ™‚å‚³å…¥é€™äº›é¡å¤–è³‡è¨Šï¼Œä¸¦åœ¨æ•´å€‹ Thread ä¸­ä¿æŒé€™äº›ç‹€æ…‹ã€‚\r---\r### å››ã€ å°æŠ—å¤±æ†¶èˆ‡åˆ†å¿ƒï¼šä¸‰å¤§è¨˜æ†¶ç®¡ç†ç­–ç•¥\rç•¶å°è©±è¶Šä¾†è¶Šé•·ï¼ŒContext Window å¿«çˆ†äº†æ€éº¼è¾¦ï¼Ÿæ–‡ä»¶æä¾›äº†ä¸‰ç¨®å¸¸è¦‹æ¨¡å¼ï¼š\r#### 1. Trim messages (ä¿®å‰ªè¨Šæ¯)\ræœ€æš´åŠ›ä½†ä¹Ÿæœ€ç›´æ¥ã€‚ä½¿ç”¨ `@before_model` middlewareï¼Œåœ¨è¨Šæ¯é€é€² LLM ä¹‹å‰ï¼Œåªä¿ç•™æœ€å¾Œ N å€‹ Token æˆ– N å‰‡è¨Šæ¯ã€‚\r- **å„ªé»**ï¼šç°¡å–®ï¼Œç¢ºä¿ä¸çˆ† Tokenã€‚\r- **å¯¦ä½œ**ï¼šåˆ©ç”¨ `RemoveMessage` æ¨™è¨˜èˆŠè¨Šæ¯ç‚ºåˆªé™¤ç‹€æ…‹ã€‚\r#### 2. Delete messages (åˆªé™¤è¨Šæ¯)\ré€™é€šå¸¸ç”¨æ–¼æ¸…é™¤æ•æ„Ÿè³‡è¨Šæˆ–æ˜¯æ˜é¡¯å·²ç¶“éæ™‚çš„å°è©±ã€‚\ré€é `@after_model` middlewareï¼Œæª¢æŸ¥æœ€æ–°ç”Ÿæˆçš„è¨Šæ¯ï¼Œå¦‚æœåŒ…å«æ•æ„Ÿè©ï¼ˆå¦‚ passwordï¼‰ï¼Œç›´æ¥å°‡å…¶å¾ State ä¸­ç§»é™¤ã€‚\r- **è­¦å‘Š**ï¼šåˆªé™¤è¨Šæ¯æ™‚è¦å°å¿ƒç¶­è­·å°è©±çµæ§‹çš„æœ‰æ•ˆæ€§ã€‚ä¾‹å¦‚ï¼Œæœ‰äº› Provider è¦æ±‚å°è©±å¿…é ˆç”± `user` é–‹é ­ï¼Œæˆ–è€… `tool` çš„çµæœå¿…é ˆç·Šè·Ÿåœ¨ `assistant` çš„å‘¼å«ä¹‹å¾Œã€‚\r#### 3. Summarize messages (æ‘˜è¦è¨Šæ¯)\ré€™æ˜¯ä¸€ç¨®æ›´å„ªé›…çš„åšæ³•ã€‚èˆ‡å…¶ä¸Ÿæ£„èˆŠè¨Šæ¯ï¼Œä¸å¦‚å«å¦ä¸€å€‹ LLM æŠŠå‰é¢çš„å°è©±ã€Œæ¿ƒç¸®ã€æˆæ‘˜è¦ã€‚\rLangChain å…§å»ºäº† `SummarizationMiddleware`ï¼š\r```python\rSummarizationMiddleware(\rmodel=\"gpt-4o-mini\", # è² è²¬æ‘˜è¦çš„å°æ¨¡å‹\rtrigger=(\"tokens\", 4000), # è¶…é 4000 token å°±è§¸ç™¼\rkeep=(\"messages\", 20) # ä¿ç•™æœ€è¿‘ 20 å‰‡åŸå§‹è¨Šæ¯\r)\r```\ré€™æ¨£æ—¢çœ Tokenï¼Œåˆä¿ç•™äº†é—œéµè³‡è¨Šã€‚\r---\r### äº”ã€ é§­å…¥å¤§è…¦ï¼šåœ¨ Tools èˆ‡ Middleware ä¸­å­˜å–è¨˜æ†¶\ræœ‰äº†ç‹€æ…‹ï¼Œæˆ‘å€‘è¦æ€éº¼è®€å¯«å®ƒï¼Ÿ\r#### 1. åœ¨ Tools è£¡é¢è®€å¯«\ré€™æ˜¯å¾ˆå¤šé–‹ç™¼è€…å¿½ç•¥çš„åŠŸèƒ½ã€‚Tool ä¸åªèƒ½å›å‚³å­—ä¸²ï¼Œé‚„èƒ½ç›´æ¥ä¿®æ”¹ Agent çš„è¨˜æ†¶ã€‚\r- **è®€å–**ï¼šé€é `runtime: ToolRuntime` åƒæ•¸ï¼ˆé€™å° LLM æ˜¯éš±è—çš„ï¼‰ï¼Œå¯ä»¥ç›´æ¥å­˜å– `runtime.state` æˆ– `runtime.context`ã€‚\r- **å¯«å…¥**ï¼šå›å‚³ `Command(update={...})`ã€‚\rä¾‹å¦‚ï¼Œä¸€å€‹æ›´æ–°ä½¿ç”¨è€…è³‡æ–™çš„ Toolï¼š\r```python\r@tool\rdef update_user_info(runtime: ToolRuntime[CustomContext, CustomState]) -\u003e Command:\r# è®€å– Context\ruser_id = runtime.context.user_id\r# æ›´æ–° State èˆ‡ Message History\rreturn Command(update={\r\"user_name\": \"John Smith\",\r\"messages\": [ToolMessage(\"Updated info\", tool_call_id=...)]\r})\r```\r#### 2. å‹•æ…‹ Prompt (Dynamic Prompts)\ré€é `@dynamic_prompt` middlewareï¼Œæˆ‘å€‘å¯ä»¥æ ¹æ“šç•¶ä¸‹çš„ State ä¾†å‹•æ…‹æ”¹è®Š System Promptã€‚\rä¾‹å¦‚ï¼š`f\"You are a helpful assistant. Address the user as {user_name}.\"`ï¼Œè®“ Agent æ°¸é çŸ¥é“ä½¿ç”¨è€…çš„åå­—ã€‚\r---\r### å…­ã€ çµèª\rLangChain çš„ Short-term memory æ©Ÿåˆ¶å…¶å¯¦å°±æ˜¯åœç¹è‘— **State Management (ç‹€æ…‹ç®¡ç†)** é‹ä½œçš„ã€‚\rå¾åŸºç¤çš„ `checkpointer` æŒä¹…åŒ–ï¼Œåˆ°é€²éšçš„ `AgentState` å®¢è£½åŒ–ï¼Œå†åˆ°é€é Middleware é€²è¡Œã€Œè¨˜æ†¶æ•´å®¹ã€ï¼ˆä¿®å‰ªã€æ‘˜è¦ï¼‰ï¼Œé€™å¥—ç³»çµ±æä¾›äº†æ¥µå¤§çš„éˆæ´»æ€§ã€‚\r**ToolRuntime** çš„è¨­è¨ˆï¼Œè®“ Tool ä¸å†åªæ˜¯è¢«å‹•çš„å‡½æ•¸ï¼Œè€Œæ˜¯èƒ½ä¸»å‹•èˆ‡ Agent çš„å¤§è…¦äº’å‹•ã€‚æŒæ¡äº†é€™äº›ï¼Œä½ çš„ Agent å°±ä¸å†æ˜¯èŠå…©å¥å°±å¿˜çš„é‡‘é­šè…¦ï¼Œè€Œæ˜¯èƒ½èˆ‡ä½¿ç”¨è€…å»ºç«‹é•·æœŸé€£çµçš„æ™ºæ…§å¤¥ä¼´ã€‚ ","wordCount":"413","inLanguage":"en","datePublished":"2025-11-07T00:00:00Z","dateModified":"2025-11-07T00:00:00Z","author":{"@type":"Person","name":"Aura"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://aura.codex.tw/posts/temp1.5/ep10/"},"publisher":{"@type":"Organization","name":"Aura's Space","logo":{"@type":"ImageObject","url":"https://aura.codex.tw/images/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://aura.codex.tw/ accesskey=h title="Aura's Space (Alt + H)"><img src=https://aura.codex.tw/images/favicon.ico alt aria-label=logo height=35>Aura's Space</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://aura.codex.tw/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://aura.codex.tw/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://aura.codex.tw/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://aura.codex.tw/about/ title=About><span>About</span></a></li><li><a href=https://aura.codex.tw/search/ title="ğŸ” (Alt + /)" accesskey=/><span>ğŸ”</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://aura.codex.tw/>Home</a>&nbsp;Â»&nbsp;<a href=https://aura.codex.tw/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">ã€Temperature 1.5 çš„æ—¥å¸¸ã€‘EP10: æ‹’çµ•é‡‘é­šè…¦ - æ·±å…¥è§£æ LangChain çš„ Short-term Memory èˆ‡ç‹€æ…‹ç®¡ç†</h1><div class=post-meta><span title='2025-11-07 00:00:00 +0000 UTC'>November 7, 2025</span>&nbsp;Â·&nbsp;<span>2 min</span>&nbsp;Â·&nbsp;<span>Aura</span></div></header><ul class=post-tags><li><a href=https://aura.codex.tw/tags/langchain/>LangChain</a></li><li><a href=https://aura.codex.tw/tags/python/>Python</a></li><li><a href=https://aura.codex.tw/tags/langgraph/>LangGraph</a></li></ul><div class=post-content><hr><blockquote><p>æœ¬æ–‡ç‚ºå€‹äººå­¸ç¿’ç­†è¨˜ï¼Œè¨˜éŒ„äº†å­¸ç¿’éç¨‹ä¸­çš„ä¸€äº›çŸ¥è­˜ï¼Œå¯åƒè€ƒï¼Œä½†ä¸å¯èªçœŸï¼Œå­¸ç¿’çš„éç¨‹å¯èƒ½æœ‰ç†è§£éŒ¯èª¤ï¼Œè³‡è¨Šä¸ä¸€å®šæ­£ç¢ºï¼Œç•¢ç«Ÿ Temperature éƒ½ 1.5 äº†ã€‚</p></blockquote><hr><h3 id=é›¶-å‰è¨€>é›¶ã€ å‰è¨€<a hidden class=anchor aria-hidden=true href=#é›¶-å‰è¨€>#</a></h3><p>æ¥çºŒä¸Šæ¬¡æˆ‘å€‘èŠåˆ°çš„ <strong>MCP (Model Context Protocol)</strong>ï¼Œæˆ‘å€‘è®“ Agent èƒ½å¤ é€éé€šç”¨æ¨™æº–é€£æ¥å„å¼å„æ¨£çš„å·¥å…·èˆ‡è³‡æºã€‚ä½†å¦‚æœä½ çš„ Agent é€£æ¥äº†å…¨ä¸–ç•Œï¼Œå»è½‰é ­å°±å¿˜è¨˜ä½ æ˜¯èª°ï¼Œé‚£ä¹Ÿæ˜¯ç™½æ­ã€‚</p><p>åœ¨è¤‡é›œçš„å°è©±ä»»å‹™ä¸­ï¼Œè¨˜æ†¶ (Memory) æ˜¯æ ¸å¿ƒã€‚ä»Šå¤©æˆ‘å€‘è¦ä¾†æ¢è¨ LangChain æ–‡ä»¶ä¸­é—œæ–¼ <strong>Short-term memory (çŸ­æœŸè¨˜æ†¶)</strong> çš„å¯¦ä½œæ©Ÿåˆ¶ã€‚å¦‚ä½•åœ¨æœ‰é™çš„ Context Window å…§ï¼Œè®“ Agent æ—¢èƒ½è¨˜å¾—ä¹‹å‰çš„äº’å‹•ï¼Œåˆä¸æœƒå› ç‚ºè³‡è¨Šéè¼‰è€Œã€Œåˆ†å¿ƒã€æˆ–è®Šæ…¢ï¼Ÿè®“æˆ‘å€‘çœ‹ä¸‹å»ã€‚</p><hr><h3 id=ä¸€-ä»€éº¼æ˜¯çŸ­æœŸè¨˜æ†¶èˆ‡-thread>ä¸€ã€ ä»€éº¼æ˜¯çŸ­æœŸè¨˜æ†¶èˆ‡ Threadï¼Ÿ<a hidden class=anchor aria-hidden=true href=#ä¸€-ä»€éº¼æ˜¯çŸ­æœŸè¨˜æ†¶èˆ‡-thread>#</a></h3><p>åœ¨ LangChain çš„å®šç¾©è£¡ï¼ŒçŸ­æœŸè¨˜æ†¶ä¸»è¦æŒ‡çš„æ˜¯ <strong>Thread-level persistence</strong>ã€‚</p><p>é€™æ¦‚å¿µå¾ˆåƒ Email çš„ç¾¤çµ„ä¿¡ä»¶æˆ–æ˜¯ Slack çš„è¨è«–ä¸²ã€‚ä¸€å€‹ <strong>Thread</strong> çµ„ç¹”äº†å–®ä¸€æœƒè©±ä¸­çš„æ‰€æœ‰äº’å‹•ã€‚é€™å°æ–¼ Agent è‡³é—œé‡è¦ï¼Œå› ç‚ºå®ƒéœ€è¦ï¼š</p><ol><li>è¨˜ä½ä¹‹å‰çš„äº’å‹•ï¼ˆContextï¼‰ã€‚</li><li>å¾å›é¥‹ä¸­å­¸ç¿’ã€‚</li><li>é©æ‡‰ä½¿ç”¨è€…çš„åå¥½ã€‚</li></ol><p>ç„¶è€Œï¼ŒæŒ‘æˆ°åœ¨æ–¼ LLM çš„ <strong>Context Window (ä¸Šä¸‹æ–‡è¦–çª—)</strong> æ˜¯æœ‰é™çš„ã€‚å³ä¾¿æ¨¡å‹æ”¯æ´è¶…é•·æ–‡æœ¬ï¼Œå¡å…¥éå¤šèˆŠè³‡è¨Šæœƒå°è‡´æ¨¡å‹ã€Œåˆ†å¿ƒ (distracted)ã€ï¼Œåæ‡‰è®Šæ…¢ä¸”æˆæœ¬è®Šé«˜ã€‚å› æ­¤ï¼Œæˆ‘å€‘éœ€è¦ä¸€å¥—æ©Ÿåˆ¶ä¾†ç®¡ç†é€™äº›è¨Šæ¯æµã€‚</p><hr><h3 id=äºŒ-å•Ÿç”¨è¨˜æ†¶checkpointer-æ˜¯é—œéµ>äºŒã€ å•Ÿç”¨è¨˜æ†¶ï¼šCheckpointer æ˜¯é—œéµ<a hidden class=anchor aria-hidden=true href=#äºŒ-å•Ÿç”¨è¨˜æ†¶checkpointer-æ˜¯é—œéµ>#</a></h3><p>è¦è®“ Agent æ“æœ‰è¨˜æ†¶ï¼Œä½ ä¸èƒ½åªæ˜¯æŠŠå®ƒè·‘èµ·ä¾†ï¼Œä½ éœ€è¦åœ¨å»ºç«‹ Agent æ™‚æŒ‡å®šä¸€å€‹ <strong><code>checkpointer</code></strong>ã€‚</p><p>LangChain çš„ Agent å°‡è¨˜æ†¶è¦–ç‚º <strong>State (ç‹€æ…‹)</strong> çš„ä¸€éƒ¨åˆ†ã€‚</p><ul><li><strong>State</strong>ï¼šå„²å­˜å°è©±æ­·å²èˆ‡è®Šæ•¸ã€‚</li><li><strong>Checkpointer</strong>ï¼šè² è²¬å°‡ State æŒä¹…åŒ–åˆ°è³‡æ–™åº«æˆ–è¨˜æ†¶é«”ä¸­ã€‚</li></ul><h4 id=1-é–‹ç™¼éšæ®µ-in-memory>1. é–‹ç™¼éšæ®µ (In Memory)<a hidden class=anchor aria-hidden=true href=#1-é–‹ç™¼éšæ®µ-in-memory>#</a></h4><p>åœ¨æ¸¬è©¦æ™‚ï¼Œæˆ‘å€‘é€šå¸¸ä½¿ç”¨ <code>InMemorySaver</code>ï¼Œå®ƒåªæœƒæ´»åœ¨ç•¶ä¸‹çš„åŸ·è¡Œç’°å¢ƒä¸­ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langgraph.checkpoint.memory</span> <span class=kn>import</span> <span class=n>InMemorySaver</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>langchain.agents</span> <span class=kn>import</span> <span class=n>create_agent</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>agent</span> <span class=o>=</span> <span class=n>create_agent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;gpt-5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>tools</span><span class=o>=</span><span class=p>[</span><span class=n>get_user_info</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=c1># åŠ ä¸Šé€™è¡Œï¼ŒAgent å°±æœ‰è…¦å­äº†</span>
</span></span><span class=line><span class=cl>    <span class=n>checkpointer</span><span class=o>=</span><span class=n>InMemorySaver</span><span class=p>(),</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è¨˜å¾—å¸¶ä¸Š thread_idï¼Œé€™æ˜¯è¨˜æ†¶çš„é‘°åŒ™</span>
</span></span><span class=line><span class=cl><span class=n>agent</span><span class=o>.</span><span class=n>invoke</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=s2>&#34;messages&#34;</span><span class=p>:</span> <span class=p>[{</span><span class=s2>&#34;role&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span><span class=p>,</span> <span class=s2>&#34;content&#34;</span><span class=p>:</span> <span class=s2>&#34;Hi! My name is Bob.&#34;</span><span class=p>}]},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=s2>&#34;configurable&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;thread_id&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span><span class=p>}},</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><pre tabindex=0><code>
#### 2. ç”Ÿç”¢ç’°å¢ƒ (Database)

ä¸Šç·šå¾Œï¼Œä½ éœ€è¦å°‡ç‹€æ…‹å­˜é€²è³‡æ–™åº«ã€‚LangChain æä¾›äº† `langgraph-checkpoint-postgres` ç­‰å¥—ä»¶ã€‚

```python
from langgraph.checkpoint.postgres import PostgresSaver

# é€é Connection String é€£æ¥ Postgres
with PostgresSaver.from_conn_string(DB_URI) as checkpointer:
    checkpointer.setup() # è‡ªå‹•å»ºç«‹è³‡æ–™è¡¨
    agent = create_agent(..., checkpointer=checkpointer)

```

---

### ä¸‰ã€ å®šè£½ä½ çš„å¤§è…¦ï¼šCustomizing Agent State

é è¨­æƒ…æ³ä¸‹ï¼ŒAgent ä½¿ç”¨ `AgentState` ä¾†ç®¡ç†è¨˜æ†¶ï¼Œè£¡é¢ä¸»è¦å°±æ˜¯ `messages`ã€‚ä½†ç¾å¯¦ä¸–ç•Œä¸­ï¼Œæˆ‘å€‘å¾€å¾€éœ€è¦å­˜æ›´å¤šæ±è¥¿ï¼Œæ¯”å¦‚ä½¿ç”¨è€… ID æˆ–åå¥½è¨­å®šã€‚

æˆ‘å€‘å¯ä»¥ç¹¼æ‰¿ `AgentState` ä¾†æ“´å…… schemaï¼š

```python
class CustomAgentState(AgentState):
    user_id: str      # æ–°å¢æ¬„ä½
    preferences: dict # æ–°å¢æ¬„ä½

agent = create_agent(
    &#34;gpt-5&#34;,
    tools=[...],
    state_schema=CustomAgentState, # å‘Šè¨´ Agent æ–°çš„è…¦å®¹é‡çµæ§‹
    checkpointer=InMemorySaver(),
)

```

é€™æ¨£æˆ‘å€‘å°±èƒ½åœ¨ `invoke` æ™‚å‚³å…¥é€™äº›é¡å¤–è³‡è¨Šï¼Œä¸¦åœ¨æ•´å€‹ Thread ä¸­ä¿æŒé€™äº›ç‹€æ…‹ã€‚

---

### å››ã€ å°æŠ—å¤±æ†¶èˆ‡åˆ†å¿ƒï¼šä¸‰å¤§è¨˜æ†¶ç®¡ç†ç­–ç•¥

ç•¶å°è©±è¶Šä¾†è¶Šé•·ï¼ŒContext Window å¿«çˆ†äº†æ€éº¼è¾¦ï¼Ÿæ–‡ä»¶æä¾›äº†ä¸‰ç¨®å¸¸è¦‹æ¨¡å¼ï¼š

#### 1. Trim messages (ä¿®å‰ªè¨Šæ¯)

æœ€æš´åŠ›ä½†ä¹Ÿæœ€ç›´æ¥ã€‚ä½¿ç”¨ `@before_model` middlewareï¼Œåœ¨è¨Šæ¯é€é€² LLM ä¹‹å‰ï¼Œåªä¿ç•™æœ€å¾Œ N å€‹ Token æˆ– N å‰‡è¨Šæ¯ã€‚

- **å„ªé»**ï¼šç°¡å–®ï¼Œç¢ºä¿ä¸çˆ† Tokenã€‚
- **å¯¦ä½œ**ï¼šåˆ©ç”¨ `RemoveMessage` æ¨™è¨˜èˆŠè¨Šæ¯ç‚ºåˆªé™¤ç‹€æ…‹ã€‚

#### 2. Delete messages (åˆªé™¤è¨Šæ¯)

é€™é€šå¸¸ç”¨æ–¼æ¸…é™¤æ•æ„Ÿè³‡è¨Šæˆ–æ˜¯æ˜é¡¯å·²ç¶“éæ™‚çš„å°è©±ã€‚
é€é `@after_model` middlewareï¼Œæª¢æŸ¥æœ€æ–°ç”Ÿæˆçš„è¨Šæ¯ï¼Œå¦‚æœåŒ…å«æ•æ„Ÿè©ï¼ˆå¦‚ passwordï¼‰ï¼Œç›´æ¥å°‡å…¶å¾ State ä¸­ç§»é™¤ã€‚

- **è­¦å‘Š**ï¼šåˆªé™¤è¨Šæ¯æ™‚è¦å°å¿ƒç¶­è­·å°è©±çµæ§‹çš„æœ‰æ•ˆæ€§ã€‚ä¾‹å¦‚ï¼Œæœ‰äº› Provider è¦æ±‚å°è©±å¿…é ˆç”± `user` é–‹é ­ï¼Œæˆ–è€… `tool` çš„çµæœå¿…é ˆç·Šè·Ÿåœ¨ `assistant` çš„å‘¼å«ä¹‹å¾Œã€‚

#### 3. Summarize messages (æ‘˜è¦è¨Šæ¯)

é€™æ˜¯ä¸€ç¨®æ›´å„ªé›…çš„åšæ³•ã€‚èˆ‡å…¶ä¸Ÿæ£„èˆŠè¨Šæ¯ï¼Œä¸å¦‚å«å¦ä¸€å€‹ LLM æŠŠå‰é¢çš„å°è©±ã€Œæ¿ƒç¸®ã€æˆæ‘˜è¦ã€‚

LangChain å…§å»ºäº† `SummarizationMiddleware`ï¼š

```python
SummarizationMiddleware(
    model=&#34;gpt-4o-mini&#34;,   # è² è²¬æ‘˜è¦çš„å°æ¨¡å‹
    trigger=(&#34;tokens&#34;, 4000), # è¶…é 4000 token å°±è§¸ç™¼
    keep=(&#34;messages&#34;, 20)     # ä¿ç•™æœ€è¿‘ 20 å‰‡åŸå§‹è¨Šæ¯
)

```

é€™æ¨£æ—¢çœ Tokenï¼Œåˆä¿ç•™äº†é—œéµè³‡è¨Šã€‚

---

### äº”ã€ é§­å…¥å¤§è…¦ï¼šåœ¨ Tools èˆ‡ Middleware ä¸­å­˜å–è¨˜æ†¶

æœ‰äº†ç‹€æ…‹ï¼Œæˆ‘å€‘è¦æ€éº¼è®€å¯«å®ƒï¼Ÿ

#### 1. åœ¨ Tools è£¡é¢è®€å¯«

é€™æ˜¯å¾ˆå¤šé–‹ç™¼è€…å¿½ç•¥çš„åŠŸèƒ½ã€‚Tool ä¸åªèƒ½å›å‚³å­—ä¸²ï¼Œé‚„èƒ½ç›´æ¥ä¿®æ”¹ Agent çš„è¨˜æ†¶ã€‚

- **è®€å–**ï¼šé€é `runtime: ToolRuntime` åƒæ•¸ï¼ˆé€™å° LLM æ˜¯éš±è—çš„ï¼‰ï¼Œå¯ä»¥ç›´æ¥å­˜å– `runtime.state` æˆ– `runtime.context`ã€‚
- **å¯«å…¥**ï¼šå›å‚³ `Command(update={...})`ã€‚

ä¾‹å¦‚ï¼Œä¸€å€‹æ›´æ–°ä½¿ç”¨è€…è³‡æ–™çš„ Toolï¼š

```python
@tool
def update_user_info(runtime: ToolRuntime[CustomContext, CustomState]) -&gt; Command:
    # è®€å– Context
    user_id = runtime.context.user_id
    # æ›´æ–° State èˆ‡ Message History
    return Command(update={
        &#34;user_name&#34;: &#34;John Smith&#34;,
        &#34;messages&#34;: [ToolMessage(&#34;Updated info&#34;, tool_call_id=...)]
    })

```

#### 2. å‹•æ…‹ Prompt (Dynamic Prompts)

é€é `@dynamic_prompt` middlewareï¼Œæˆ‘å€‘å¯ä»¥æ ¹æ“šç•¶ä¸‹çš„ State ä¾†å‹•æ…‹æ”¹è®Š System Promptã€‚
ä¾‹å¦‚ï¼š`f&#34;You are a helpful assistant. Address the user as {user_name}.&#34;`ï¼Œè®“ Agent æ°¸é çŸ¥é“ä½¿ç”¨è€…çš„åå­—ã€‚

---

### å…­ã€ çµèª

LangChain çš„ Short-term memory æ©Ÿåˆ¶å…¶å¯¦å°±æ˜¯åœç¹è‘— **State Management (ç‹€æ…‹ç®¡ç†)** é‹ä½œçš„ã€‚

å¾åŸºç¤çš„ `checkpointer` æŒä¹…åŒ–ï¼Œåˆ°é€²éšçš„ `AgentState` å®¢è£½åŒ–ï¼Œå†åˆ°é€é Middleware é€²è¡Œã€Œè¨˜æ†¶æ•´å®¹ã€ï¼ˆä¿®å‰ªã€æ‘˜è¦ï¼‰ï¼Œé€™å¥—ç³»çµ±æä¾›äº†æ¥µå¤§çš„éˆæ´»æ€§ã€‚

**ToolRuntime** çš„è¨­è¨ˆï¼Œè®“ Tool ä¸å†åªæ˜¯è¢«å‹•çš„å‡½æ•¸ï¼Œè€Œæ˜¯èƒ½ä¸»å‹•èˆ‡ Agent çš„å¤§è…¦äº’å‹•ã€‚æŒæ¡äº†é€™äº›ï¼Œä½ çš„ Agent å°±ä¸å†æ˜¯èŠå…©å¥å°±å¿˜çš„é‡‘é­šè…¦ï¼Œè€Œæ˜¯èƒ½èˆ‡ä½¿ç”¨è€…å»ºç«‹é•·æœŸé€£çµçš„æ™ºæ…§å¤¥ä¼´ã€‚
</code></pre></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2022~2026 <a href=https://aura.codex.tw/>Aura's Space</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>